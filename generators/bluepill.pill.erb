app_name            = '<%= application %>'
rails_root          = '<%= release_path %>'
#rails_root          = '<%= deploy_to %>/current'
puma_bin            = 'bundle exec puma'
puma_min_threads    = 8
puma_max_threads    = 32
working_dir         = '<%= release_path %>'
#working_dir         = '<%= deploy_to %>/current'

# to change between socks/tcp options should be added instead of static?

# puma
Bluepill.application(app_name) do |app|
    app.process("puma") do |process|
        process.start_command = "#{puma_bin} -b unix:///var/run/puma/#{app_name}_#{RAILS_ENV}.sock"
        process.pid_file = "/var/run/puma/#{app_name}_#{RAILS_ENV}.pid"
        process.daemonize = true
        process.checks :cpu_usage, :every => 10.seconds, :below => 95, :times => 4
        process.checks :mem_usage, :every => 10.seconds, :below => 256.megabytes,  :times => [3,5]
        process.start_grace_time = 4.seconds
        process.stop_grace_time = 10.seconds
        process.restart_grace_time = process.start_grace_time + process.stop_grace_time
        process.working_dir = working_dir
    end
end
